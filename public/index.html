<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HarmoniSync</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <!-- Background Decor -->
    <img src="assets/note1.svg" class="floating-note note-1">
    <img src="assets/note2.svg" class="floating-note note-2">
    <img src="assets/note3.svg" class="floating-note note-3">

    <div class="app-container">
        <header>
            <img src="assets/logo.svg" alt="Logo" class="app-logo">
            <h1>HarmoniSync</h1>
        </header>

        <!-- VIEW 1: LANDING -->
        <div id="view-landing" class="view active">
            <div class="card glass-panel">
                <input type="text" id="username" placeholder="Enter your name" maxlength="15">

                <h3
                    style="margin: 15px 0; color: #ddd; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                    Active Rooms</h3>
                <div id="room-list-container" class="room-list">
                    <!-- Populated by JS -->
                    <div style="padding: 10px; color: #777;">Scanning for rooms...</div>
                </div>

                <div style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                    <input type="text" id="new-room-name" placeholder="New Room Name (Optional)"
                        style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="app.createRoom()">+ Create New Room</button>
                    <!-- <button class="btn btn-secondary" onclick="app.showJoin()">Enter IP Address</button> -->
                </div>
            </div>
        </div>

        <!-- VIEW 2: JOIN IP (Legacy/Manual) -->
        <div id="view-join" class="view">
            <div class="card">
                <h3>Manual Connection</h3>
                <input type="text" id="room-ip" placeholder="Host IP (e.g. 192.168.0.x)">
                <button class="btn btn-primary" onclick="app.joinRoom(null)">Connect</button>
                <button class="btn btn-secondary" onclick="app.nav('view-landing')">Back</button>
            </div>
        </div>

        <!-- VIEW 3: ROOM (MAIN) -->
        <div id="view-room" class="view">
            <!-- ROOM INFO & PARTICIPANTS -->
            <div class="card glass-panel" style="padding: 15px;">
                <h4
                    style="margin-bottom: 10px; opacity: 0.8; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;">
                    Room Members</h4>
                <div id="participant-list" class="participant-grid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="card center-content">
                <h2 id="room-id-display" class="neon-text">Room Active</h2>
                <p id="connection-status" style="margin-bottom: 10px; font-size: 0.8rem; opacity: 0.6;">Connected</p>
                <canvas id="visualizer"></canvas>
            </div>

            <!-- Speaking Indicator -->
            <div id="speaking-display" class="speaker-indicator hidden">
                <div class="indicator-dot"></div>
                <span id="speaker-name" style="font-weight: bold;">User</span> is speaking...
            </div>

            <!-- AUDIO ENHANCEMENT TOGGLE -->
            <div class="card glass-panel"
                style="padding: 10px 15px; margin-top: 10px; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 0.9rem; opacity: 0.8;">✨ Clean Audio</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="enhance-toggle" onchange="app.toggleEnhancement()">
                    <span class="slider round"></span>
                </label>
            </div>

            <div style="flex: 1;"></div>

            <!-- HOST CONTROLS (Hidden by default) -->
            <div id="host-panel" class="hidden" style="width: 100%; margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="app.endSession()"
                    style="border-color: #ff4444; color: #ff4444;">
                    ⚠️ End Session for All
                </button>
            </div>

            <!-- PUSH TO TALK -->
            <button id="talk-btn" class="btn btn-primary btn-large glow-effect">
                <img src="assets/logo.svg" style="height: 30px; filter: invert(1); margin-right: 10px;">
                <span>Tap to Speak</span>
            </button>

            <button class="btn btn-secondary" onclick="app.leaveRoom()" style="margin-top: 10px; opacity: 0.7;">Leave
                Room</button>

        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>